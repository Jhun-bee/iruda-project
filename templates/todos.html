{% extends "base.html" %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-6xl mx-auto">
        <!-- í˜ì´ì§€ í—¤ë” -->
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold iruda-blue">í•  ì¼ ê´€ë¦¬</h1>
            <div class="flex items-center space-x-4">
                <button onclick="checkOverdueTodos()" 
                        class="bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600">
                    âš ï¸ ì—°ì²´ í™•ì¸
                </button>
                <button onclick="rescheduleOverdue()" 
                        class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">
                    ğŸ”„ ì—°ì²´ ì¬ê³„íš
                </button>
                <button onclick="addNewTodo()" 
                        class="iruda-bg-orange text-white px-4 py-2 rounded-lg hover:opacity-90">
                    â• ìƒˆ í•  ì¼
                </button>
            </div>
        </div>

        <!-- í†µê³„ ì¹´ë“œ -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
            <div class="bg-white rounded-lg shadow p-4">
                <h3 class="text-sm font-medium text-gray-500">ì „ì²´ í•  ì¼</h3>
                <p class="text-2xl font-bold text-gray-900" id="totalCount">{{ todos|length }}</p>
            </div>
            <div class="bg-white rounded-lg shadow p-4">
                <h3 class="text-sm font-medium text-gray-500">ì™„ë£Œ</h3>
                <p class="text-2xl font-bold text-green-600" id="completedCount">
                    {{ todos|selectattr('status', 'equalto', 'completed')|list|length }}
                </p>
            </div>
            <div class="bg-white rounded-lg shadow p-4">
                <h3 class="text-sm font-medium text-gray-500">ì˜¤ëŠ˜ ë§ˆê°</h3>
                <p class="text-2xl font-bold text-orange-600" id="dueTodayCount">
                    {{ todos|selectattr('is_due_today', 'equalto', true)|list|length }}
                </p>
            </div>
            <div class="bg-white rounded-lg shadow p-4">
                <h3 class="text-sm font-medium text-gray-500">ì—°ì²´</h3>
                <p class="text-2xl font-bold text-red-600" id="overdueCount">
                    {{ todos|selectattr('is_overdue', 'equalto', true)|list|length }}
                </p>
            </div>
        </div>

        <!-- í•„í„° ë° ì •ë ¬ -->
        <div class="bg-white rounded-lg shadow p-4 mb-6">
            <div class="flex flex-wrap gap-4 items-center">
                <select id="statusFilter" onchange="filterTodos()" 
                        class="p-2 border border-gray-300 rounded-lg">
                    <option value="all">ëª¨ë“  ìƒíƒœ</option>
                    <option value="pending">ëŒ€ê¸°ì¤‘</option>
                    <option value="in_progress">ì§„í–‰ì¤‘</option>
                    <option value="completed">ì™„ë£Œ</option>
                </select>
                
                <select id="priorityFilter" onchange="filterTodos()" 
                        class="p-2 border border-gray-300 rounded-lg">
                    <option value="all">ëª¨ë“  ìš°ì„ ìˆœìœ„</option>
                    <option value="high">ë†’ìŒ</option>
                    <option value="medium">ë³´í†µ</option>
                    <option value="low">ë‚®ìŒ</option>
                </select>
                
                <select id="categoryFilter" onchange="filterTodos()" 
                        class="p-2 border border-gray-300 rounded-lg">
                    <option value="all">ëª¨ë“  ì¹´í…Œê³ ë¦¬</option>
                    <option value="1ê°œì›”">1ê°œì›”</option>
                    <option value="3ê°œì›”">3ê°œì›”</option>
                    <option value="6ê°œì›”">6ê°œì›”</option>
                </select>
                
                <input type="text" id="searchInput" placeholder="í•  ì¼ ê²€ìƒ‰..." 
                       onkeyup="filterTodos()" 
                       class="p-2 border border-gray-300 rounded-lg flex-1">
            </div>
        </div>

        <!-- í•  ì¼ ëª©ë¡ -->
        <div id="todosList" class="space-y-4">
            {% if todos %}
                {% for todo in todos %}
                <div class="todo-item bg-white rounded-lg shadow p-6 
                    {% if todo.is_overdue %}border-l-4 border-red-500 bg-red-50{% elif todo.is_due_today %}border-l-4 border-orange-500 bg-orange-50{% elif todo.status == 'completed' %}bg-gray-50 opacity-75{% endif %}"
                    data-status="{{ todo.status }}" data-priority="{{ todo.priority }}" data-category="{{ todo.category }}">
                    
                    <!-- í•  ì¼ í—¤ë” -->
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex items-start space-x-3 flex-1">
                            <!-- ì²´í¬ë°•ìŠ¤ -->
                            <input type="checkbox" 
                                   class="w-5 h-5 text-orange-600 border-gray-300 rounded focus:ring-orange-500 mt-1"
                                   {% if todo.status == 'completed' %}checked{% endif %}
                                   onchange="updateTodoStatus({{ todo.id }}, this.checked)">
                            
                            <!-- í•  ì¼ ë‚´ìš© -->
                            <div class="flex-1">
                                <h3 class="font-semibold text-lg {% if todo.status == 'completed' %}line-through text-gray-500{% endif %}">
                                    {{ todo.title }}
                                </h3>
                                {% if todo.description %}
                                    <p class="text-gray-600 text-sm mt-1">{{ todo.description }}</p>
                                {% endif %}
                                
                                <!-- ë©”íƒ€ ì •ë³´ -->
                                <div class="flex flex-wrap gap-2 mt-2 text-xs">
                                    <span class="px-2 py-1 {{ priority_color(todo.priority) }} rounded-full">
                                        {% if todo.priority == 'high' %}ğŸ”´ ë†’ìŒ
                                        {% elif todo.priority == 'medium' %}ğŸŸ¡ ë³´í†µ
                                        {% else %}ğŸŸ¢ ë‚®ìŒ{% endif %}
                                    </span>
                                    
                                    <span class="px-2 py-1 bg-gray-100 text-gray-800 rounded-full">
                                        ğŸ“… {{ format_date(todo.due_date) }}
                                    </span>
                                    
                                    <span class="px-2 py-1 bg-blue-200 text-blue-900 rounded-full font-medium">
                                        {{ days_until(todo.due_date) }}
                                    </span>
                                    
                                    {% if todo.category %}
                                        <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full">
                                            ğŸ“‚ {{ todo.category }}
                                        </span>
                                    {% endif %}
                                    
                                    {% if todo.is_overdue %}
                                        <span class="px-2 py-1 bg-red-100 text-red-800 rounded-full">
                                            âš ï¸ ì—°ì²´
                                        </span>
                                    {% elif todo.is_due_today %}
                                        <span class="px-2 py-1 bg-orange-100 text-orange-800 rounded-full">
                                            â° ì˜¤ëŠ˜ ë§ˆê°
                                        </span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- ì•¡ì…˜ ë²„íŠ¼ -->
                        <div class="flex items-center space-x-2 ml-4">
                            <button onclick="editTodo({{ todo.id }})" 
                                    class="p-2 text-blue-600 hover:bg-blue-100 rounded">
                                âœï¸
                            </button>
                            <button onclick="deleteTodo({{ todo.id }})" 
                                    class="p-2 text-red-600 hover:bg-red-100 rounded">
                                ğŸ—‘ï¸
                            </button>
                        </div>
                    </div>
                    
                    <!-- ìƒíƒœ ë³€ê²½ ë²„íŠ¼ -->
                    {% if todo.status != 'completed' %}
                    <div class="flex space-x-2 mt-4">
                        {% if todo.status == 'pending' %}
                            <button onclick="changeStatus({{ todo.id }}, 'in_progress')" 
                                    class="px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600">
                                â–¶ï¸ ì‹œì‘í•˜ê¸°
                            </button>
                        {% elif todo.status == 'in_progress' %}
                            <button onclick="changeStatus({{ todo.id }}, 'completed')" 
                                    class="px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600">
                                âœ… ì™„ë£Œí•˜ê¸°
                            </button>
                            <button onclick="changeStatus({{ todo.id }}, 'pending')" 
                                    class="px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600">
                                â¸ï¸ ì¼ì‹œì •ì§€
                            </button>
                        {% endif %}
                    </div>
                    {% else %}
                    <div class="mt-4">
                        <span class="px-3 py-1 bg-green-100 text-green-800 rounded text-sm">
                            âœ… ì™„ë£Œë¨ {% if todo.completed_at %}({{ format_date(todo.completed_at[:10]) }}){% endif %}
                        </span>
                        <button onclick="changeStatus({{ todo.id }}, 'pending')" 
                                class="ml-2 px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600">
                            ğŸ”„ ë‹¤ì‹œ ì—´ê¸°
                        </button>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <div class="bg-white rounded-lg shadow p-12 text-center">
                    <div class="w-24 h-24 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center">
                        <span class="text-4xl">ğŸ“‹</span>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                    <p class="text-gray-600 mb-4">ë¡œë“œë§µì—ì„œ í•  ì¼ì„ ìƒì„±í•˜ê±°ë‚˜ ì§ì ‘ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
                    <button onclick="addNewTodo()" 
                            class="iruda-bg-orange text-white px-4 py-2 rounded-lg hover:opacity-90">
                        â• ìƒˆ í•  ì¼ ì¶”ê°€
                    </button>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- í•  ì¼ í¸ì§‘ ëª¨ë‹¬ -->
<div id="editTodoModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-lg max-w-md w-full p-6">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold">í•  ì¼ í¸ì§‘</h3>
            <button onclick="closeEditModal()" class="text-gray-400 hover:text-gray-600 text-2xl">Ã—</button>
        </div>
        
        <form id="editTodoForm" class="space-y-4">
            <input type="hidden" id="editTodoId">
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">ì œëª©</label>
                <input type="text" id="editTitle" required
                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">ì„¤ëª…</label>
                <textarea id="editDescription" rows="3"
                          class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500"></textarea>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ë§ˆê°ì¼</label>
                    <input type="date" id="editDueDate" required
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ìš°ì„ ìˆœìœ„</label>
                    <select id="editPriority" 
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                        <option value="low">ë‚®ìŒ</option>
                        <option value="medium">ë³´í†µ</option>
                        <option value="high">ë†’ìŒ</option>
                    </select>
                </div>
            </div>
            
            <div class="flex justify-end space-x-4 pt-4">
                <button type="button" onclick="closeEditModal()" 
                        class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">
                    ì·¨ì†Œ
                </button>
                <button type="submit" 
                        class="iruda-bg-orange text-white px-4 py-2 rounded-lg hover:opacity-90">
                    ì €ì¥
                </button>
            </div>
        </form>
    </div>
</div>

<!-- ìƒˆ í•  ì¼ ì¶”ê°€ ëª¨ë‹¬ -->
<div id="addTodoModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-lg max-w-md w-full p-6">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold">ìƒˆ í•  ì¼ ì¶”ê°€</h3>
            <button onclick="closeAddModal()" class="text-gray-400 hover:text-gray-600 text-2xl">Ã—</button>
        </div>
        
        <form id="addTodoForm" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">ì œëª©</label>
                <input type="text" id="newTitle" required
                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">ì„¤ëª…</label>
                <textarea id="newDescription" rows="3"
                          class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500"></textarea>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ë§ˆê°ì¼</label>
                    <input type="date" id="newDueDate" required
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ìš°ì„ ìˆœìœ„</label>
                    <select id="newPriority" 
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                        <option value="medium">ë³´í†µ</option>
                        <option value="low">ë‚®ìŒ</option>
                        <option value="high">ë†’ìŒ</option>
                    </select>
                </div>
            </div>
            
            <div class="flex justify-end space-x-4 pt-4">
                <button type="button" onclick="closeAddModal()" 
                        class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">
                    ì·¨ì†Œ
                </button>
                <button type="submit" 
                        class="iruda-bg-orange text-white px-4 py-2 rounded-lg hover:opacity-90">
                    ì¶”ê°€
                </button>
            </div>
        </form>
    </div>
</div>

<script>
// Todo ìƒíƒœ ì—…ë°ì´íŠ¸
function updateTodoStatus(todoId, isCompleted) {
    const status = isCompleted ? 'completed' : 'pending';
    
    fetch(`/todos/${todoId}/update-status`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({status: status})
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ UI ì—…ë°ì´íŠ¸
        } else {
            alert('ìƒíƒœ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
}

// ìƒíƒœ ë³€ê²½
function changeStatus(todoId, newStatus) {
    fetch(`/todos/${todoId}/update-status`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({status: newStatus})
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert('ìƒíƒœ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
}

// Todo ì‚­ì œ
function deleteTodo(todoId) {
    if (confirm('ì •ë§ë¡œ ì´ í•  ì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        fetch(`/todos/${todoId}/delete`, {
            method: 'DELETE'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        });
    }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì•Œë¦¼ í™•ì¸
document.addEventListener('DOMContentLoaded', function() {
    checkNotifications();
});

// ì•Œë¦¼ í™•ì¸
function checkNotifications() {
    fetch('/notifications')
    .then(response => response.json())
    .then(data => {
        if (data.success && data.notifications.length > 0) {
            showNotifications(data.notifications);
        }
    })
    .catch(error => console.error('Notification error:', error));
}

// ì•Œë¦¼ í‘œì‹œ
function showNotifications(notifications) {
    let message = "ìƒˆë¡œìš´ ì•Œë¦¼ì´ ìˆìŠµë‹ˆë‹¤:\n\n";
    notifications.forEach(notif => {
        message += `â€¢ ${notif.message}\n`;
    });
    
    if (confirm(message + "\ní•  ì¼ í˜ì´ì§€ì—ì„œ í™•ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        // ì´ë¯¸ í•  ì¼ í˜ì´ì§€ì— ìˆìœ¼ë¯€ë¡œ í•„í„° ì—…ë°ì´íŠ¸
        filterTodos();
    }
}
</script>

<style>
.line-through {
    text-decoration: line-through;
}

.todo-item {
    transition: all 0.3s ease;
}

.todo-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

@media (max-width: 768px) {
    .grid.grid-cols-4 {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .flex.flex-wrap.gap-4 {
        flex-direction: column;
        gap: 1rem;
    }
}
</style>
{% endblock %}ë‹ˆë‹¤.');
        });
    }
}

// Todo í¸ì§‘ ëª¨ë‹¬ ì—´ê¸°
function editTodo(todoId) {
    // í•´ë‹¹ Todoì˜ ë°ì´í„° ì°¾ê¸°
    const todoElement = document.querySelector(`[data-todo-id="${todoId}"]`);
    // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì•¼ í•¨
    document.getElementById('editTodoId').value = todoId;
    document.getElementById('editTodoModal').classList.remove('hidden');
}

// í¸ì§‘ ëª¨ë‹¬ ë‹«ê¸°
function closeEditModal() {
    document.getElementById('editTodoModal').classList.add('hidden');
}

// í¸ì§‘ í¼ ì œì¶œ
document.getElementById('editTodoForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const todoId = document.getElementById('editTodoId').value;
    const data = {
        title: document.getElementById('editTitle').value,
        description: document.getElementById('editDescription').value,
        due_date: document.getElementById('editDueDate').value,
        priority: document.getElementById('editPriority').value
    };
    
    fetch(`/todos/${todoId}/edit`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            closeEditModal();
            location.reload();
        } else {
            alert('ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
});

// ìƒˆ í•  ì¼ ì¶”ê°€ ëª¨ë‹¬ ì—´ê¸°
function addNewTodo() {
    // ê¸°ë³¸ ë‚ ì§œ ì„¤ì • (ì˜¤ëŠ˜ + 7ì¼)
    const defaultDate = new Date();
    defaultDate.setDate(defaultDate.getDate() + 7);
    document.getElementById('newDueDate').value = defaultDate.toISOString().split('T')[0];
    
    document.getElementById('addTodoModal').classList.remove('hidden');
}

// ì¶”ê°€ ëª¨ë‹¬ ë‹«ê¸°
function closeAddModal() {
    document.getElementById('addTodoModal').classList.add('hidden');
}

// ìƒˆ í•  ì¼ ì¶”ê°€ í¼ ì œì¶œ
document.getElementById('addTodoForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const data = {
        title: document.getElementById('newTitle').value,
        description: document.getElementById('newDescription').value,
        due_date: document.getElementById('newDueDate').value,
        priority: document.getElementById('newPriority').value
    };
    
    fetch('/todos/add', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            closeAddModal();
            location.reload();
        } else {
            alert('ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
});

// í•„í„°ë§ ê¸°ëŠ¥
function filterTodos() {
    const statusFilter = document.getElementById('statusFilter').value;
    const priorityFilter = document.getElementById('priorityFilter').value;
    const categoryFilter = document.getElementById('categoryFilter').value;
    const searchInput = document.getElementById('searchInput').value.toLowerCase();
    
    const todoItems = document.querySelectorAll('.todo-item');
    
    todoItems.forEach(item => {
        const status = item.dataset.status;
        const priority = item.dataset.priority;
        const category = item.dataset.category;
        const title = item.querySelector('h3').textContent.toLowerCase();
        
        let show = true;
        
        if (statusFilter !== 'all' && status !== statusFilter) show = false;
        if (priorityFilter !== 'all' && priority !== priorityFilter) show = false;
        if (categoryFilter !== 'all' && category !== categoryFilter) show = false;
        if (searchInput && !title.includes(searchInput)) show = false;
        
        item.style.display = show ? 'block' : 'none';
    });
}

// ì—°ì²´ í•  ì¼ í™•ì¸
function checkOverdueTodos() {
    const overdueItems = document.querySelectorAll('.todo-item[data-status="pending"], .todo-item[data-status="in_progress"]');
    const overdueTodos = [];
    
    overdueItems.forEach(item => {
        if (item.classList.contains('border-red-500')) {
            overdueTodos.push(item.querySelector('h3').textContent);
        }
    });
    
    if (overdueTodos.length > 0) {
        alert(`ì—°ì²´ëœ í•  ì¼ì´ ${overdueTodos.length}ê°œ ìˆìŠµë‹ˆë‹¤:\n${overdueTodos.join('\n')}`);
    } else {
        alert('ì—°ì²´ëœ í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤!');
    }
}

// ì—°ì²´ í•  ì¼ ì¬ê³„íš
function rescheduleOverdue() {
    if (confirm('ì—°ì²´ëœ í•  ì¼ë“¤ì„ ìë™ìœ¼ë¡œ ì¬ê³„íší•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        fetch('/todos/reschedule-overdue', {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
                location.reload();
            } else {
                alert('ì¬ê³„íšì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµ